!function(s){"use strict";var a={storeCountry:function(){a.getCountry().length||s.getJSON(woongkir_params.json.country_url,function(o){o.sort(function(o,e){return o.country_name>e.country_name?1:e.country_name>o.country_name?-1:0}),Lockr.set(woongkir_params.json.country_key,o)})},getCountry:function(o,e){var i=Lockr.get(woongkir_params.json.country_key);return i&&void 0!==i?o&&o===Object(o)?a.searchLocation(i,o,e):i:[]},storeProvince:function(){a.getProvince().length||s.getJSON(woongkir_params.json.province_url,function(o){o.sort(function(o,e){return o.province_name>e.province_name?1:e.province_name>o.province_name?-1:0}),Lockr.set(woongkir_params.json.province_key,o)})},getProvince:function(o,e){var i=Lockr.get(woongkir_params.json.province_key);return i&&void 0!==i?o&&o===Object(o)?a.searchLocation(i,o,e):i:[]},storeCity:function(){a.getCity().length||s.getJSON(woongkir_params.json.city_url,function(o){o.sort(function(o,e){return o.city_name>e.city_name?1:e.city_name>o.city_name?-1:0}),Lockr.set(woongkir_params.json.city_key,o)})},getCity:function(o,e){var i=Lockr.get(woongkir_params.json.city_key);return i&&void 0!==i?o&&o===Object(o)?a.searchLocation(i,o,e):i:[]},storeSubdistrict:function(){a.getSubdistrict().length||s.getJSON(woongkir_params.json.subdistrict_url,function(o){o.sort(function(o,e){return o.subdistrict_name>e.subdistrict_name?1:e.subdistrict_name>o.subdistrict_name?-1:0}),Lockr.set(woongkir_params.json.subdistrict_key,o)})},getSubdistrict:function(o,e){var i=Lockr.get(woongkir_params.json.subdistrict_key);return i&&void 0!==i?o&&o===Object(o)?a.searchLocation(i,o,e):i:[]},searchLocation:function(o,e,i){return"filter"===i?o.filter(function(o){return a.isLocationMatch(o,e)}):o.find(function(o){return a.isLocationMatch(o,e)})},isLocationMatch:function(o,e){var i=!0;for(var r in e)o.hasOwnProperty(r)&&String(o[r]).toLowerCase()===String(e[r]).toLowerCase()||(i=!1);return i}};a.storeCountry(),a.storeProvince(),a.storeCity(),a.storeSubdistrict();var g={init:function(){g.bindEvents(),g.maybeOpenModal()},bindEvents:function(){s(document.body).off("click",".wc-shipping-zone-method-settings"),s(document.body).on("click",".wc-shipping-zone-method-settings",function(o){s(document.body).off("wc_backbone_modal_loaded",g.loadForm),s(o.currentTarget).closest("tr").find(".wc-shipping-zone-method-type").text()===woongkir_params.method_title&&s(document.body).on("wc_backbone_modal_loaded",g.loadForm)}),s(document.body).off("wc_backbone_modal_loaded",g.initSortable),s(document.body).on("wc_backbone_modal_loaded",g.initSortable),s(document.body).off("change","#woocommerce_woongkir_origin_province",g.loadFormCity),s(document.body).on("change","#woocommerce_woongkir_origin_province",g.loadFormCity),s(document.body).off("change","#woocommerce_woongkir_origin_city",g.loadFormSubdistrict),s(document.body).on("change","#woocommerce_woongkir_origin_city",g.loadFormSubdistrict),s(document.body).off("change","#woocommerce_woongkir_account_type",g.highlightFeature),s(document.body).on("change","#woocommerce_woongkir_account_type",g.highlightFeature),s(document.body).off("change","#woocommerce_woongkir_account_type",g.toggleCouriersBox),s(document.body).on("change","#woocommerce_woongkir_account_type",g.toggleCouriersBox),s(document.body).off("change","#woocommerce_woongkir_account_type",g.toggleVolumetricConverter),s(document.body).on("change","#woocommerce_woongkir_account_type",g.toggleVolumetricConverter),s(document.body).off("change","#woocommerce_woongkir_volumetric_calculator",g.toggleVolumetricDivider),s(document.body).on("change","#woocommerce_woongkir_volumetric_calculator",g.toggleVolumetricDivider),s(document.body).off("change",".woongkir-account-type",g.selectAccountType),s(document.body).on("change",".woongkir-account-type",g.selectAccountType),s(document.body).off("change",".woongkir-service--bulk",g.selectServicesBulk),s(document.body).on("change",".woongkir-service--bulk",g.selectServicesBulk),s(document.body).off("change",".woongkir-service--single",g.selectServices),s(document.body).on("change",".woongkir-service--single",g.selectServices),s(document.body).off("click",".woongkir-couriers-toggle",g.toggleServicesItems),s(document.body).on("click",".woongkir-couriers-toggle",g.toggleServicesItems)},maybeOpenModal:function(){woongkir_params.show_settings&&setTimeout(function(){for(var o=!1,e=s(document).find(".wc-shipping-zone-method-type"),i=0;i<e.length;i++){var r=e[i];if(s(r).text()===woongkir_params.method_title)return s(r).closest("tr").find(".row-actions .wc-shipping-zone-method-settings").trigger("click"),void(o=!0)}o||(s(".wc-shipping-zone-add-method").trigger("click"),s('select[name="add_method_id"]').val(woongkir_params.method_id).trigger("change"))},300)},loadForm:function(){var o=a.getProvince(),e={data:[],placeholder:woongkir_params.text.placeholder.state};if(o.length)for(var i=0;i<o.length;i++)e.data.push({id:o[i].province_id,text:o[i].province});s("#woocommerce_woongkir_origin_province").selectWoo(e).trigger("change"),s("#woocommerce_woongkir_account_type").trigger("change")},loadFormCity:function(){var o={data:[],placeholder:woongkir_params.text.placeholder.city},e=s("#woocommerce_woongkir_origin_city").val(),i="",r=s("#woocommerce_woongkir_origin_province").val(),t=a.getProvince({province_id:r});if(t){var c=a.getCity({province_id:t.province_id},"filter");if(c)for(var n=0;n<c.length;n++)o.data.push({id:c[n].city_id,text:c[n].type+" "+c[n].city_name}),e===c[n].city_id&&(i=c[n].city_id)}s("#woocommerce_woongkir_origin_city").selectWoo(o).val(i).trigger("change"),s("#woocommerce_woongkir_volumetric_calculator").trigger("change")},loadFormSubdistrict:function(){var o={data:[],placeholder:woongkir_params.text.placeholder.address_2},e=s("#woocommerce_woongkir_origin_subdistrict").val(),i="",r=s("#woocommerce_woongkir_origin_city").val(),t=a.getCity({city_id:r});if(t){var c=a.getSubdistrict({city_id:t.city_id},"filter");if(c)for(var n=0;n<c.length;n++)o.data.push({id:c[n].subdistrict_id,text:c[n].subdistrict_name}),e===c[n].subdistrict_id&&(i=c[n].subdistrict_id)}s("#woocommerce_woongkir_origin_subdistrict").selectWoo(o).val(i).trigger("change")},selectAccountType:function(o){o.preventDefault();var e=s(this).val();s(this).closest("tr").find("input").not(s(this)).prop("disabled",!1).prop("checked",!1),s(this).prop("disabled",!0),s("#woocommerce_woongkir_account_type").val(e).trigger("change")},highlightFeature:function(o){var e=s(o.currentTarget).val();s("#woongkir-account-features").find("td, th").removeClass("selected"),s("#woongkir-account-features").find(".woongkir-account-features-col-"+e).addClass("selected")},toggleVolumetricConverter:function(o){var e=s("#woocommerce_woongkir_account_type").data("accounts")[s(o.currentTarget).val()]||!1;e&&(e.volumetric?s("#woocommerce_woongkir_volumetric_calculator").trigger("change").closest("tr").show():s("#woocommerce_woongkir_volumetric_calculator, #woocommerce_woongkir_volumetric_divider").closest("tr").hide())},toggleVolumetricDivider:function(o){s(o.currentTarget).is(":checked")?s("#woocommerce_woongkir_volumetric_divider").closest("tr").show():s("#woocommerce_woongkir_volumetric_divider").closest("tr").hide()},toggleCouriersBox:function(){var o=s("#woocommerce_woongkir_account_type"),t=o.data("accounts"),c=o.data("couriers"),n=o.val();_.each(c,function(o,i){var r=0,e=_.find(c[i],function(o){return-1!==o.account.indexOf(n)});_.each(o,function(o,e){-1===o.account.indexOf(n)?(s(".woongkir-couriers-item--"+i+"--"+e).slideUp(),s(".woongkir-couriers-item--"+i+"--"+e).find(".woongkir-service").prop("checked",!1)):s(".woongkir-couriers-item--"+i+"--"+e).slideDown(),t[n].multiple_couriers||(r&&s(".woongkir-couriers-item--"+i+"--"+e).find(".woongkir-service").prop("checked",!1),s(".woongkir-couriers-item--"+i+"--"+e).find(".woongkir-service--single:checked").length&&r++),g.updateSelectedServicesCounter(s(".woongkir-couriers-item--"+i+"--"+e))}),e?s(".woongkir-couriers-wrap--"+i).show():s(".woongkir-couriers-wrap--"+i).hide()})},selectServicesBulk:function(){var o=s(this).closest(".woongkir-couriers-item").data("id"),e=s(this).closest(".woongkir-couriers-item").data("zone"),i=s("#woocommerce_woongkir_account_type"),r=i.val(),t=i.data("accounts");s(this).is(":checked")?(s(this).closest(".woongkir-couriers-item").find(".woongkir-service--single").prop("checked",!0),t[r].multiple_couriers||s(".woongkir-couriers-item").not(".woongkir-couriers-item--"+e+"--"+o).each(function(){s(this).find(".woongkir-service").prop("checked",!1),g.updateSelectedServicesCounter(s(this))})):s(this).closest(".woongkir-couriers-item-inner").find(".woongkir-service--single").prop("checked",!1),g.updateSelectedServicesCounter(s(".woongkir-couriers-item--"+e+"--"+o))},selectServices:function(){var o=s(this).closest(".woongkir-couriers-item").data("id"),e=s(this).closest(".woongkir-couriers-item").data("zone"),i=s("#woocommerce_woongkir_account_type"),r=i.val(),t=i.data("accounts");s(this).is(":checked")?(s(this).closest(".woongkir-couriers-item").find(".woongkir-service--bulk").prop("checked",!0),t[r].multiple_couriers||s(".woongkir-couriers-item").not(".woongkir-couriers-item--"+e+"--"+o).each(function(){s(this).find(".woongkir-service").prop("checked",!1),g.updateSelectedServicesCounter(s(this))})):s(this).closest(".woongkir-services").find(".woongkir-service--single:checked").length||s(this).closest(".woongkir-couriers-item").find(".woongkir-service--bulk").prop("checked",!1),g.updateSelectedServicesCounter(s(".woongkir-couriers-item--"+e+"--"+o))},updateSelectedServicesCounter:function(o){o.find(".woongkir-couriers--selected").text(o.find(".woongkir-service--single:checked").length)},toggleServicesItems:function(o){o.preventDefault(),s(o.currentTarget).find(".dashicons").toggleClass("dashicons-admin-generic dashicons-arrow-up-alt2").closest(".woongkir-couriers-item").toggleClass("expanded")},initSortable:function(){s(".woongkir-couriers").sortable({axis:"y",cursor:"move"})}};s(document).ready(g.init)}(jQuery);